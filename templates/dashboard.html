<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            background: #f4f4f4; 
            margin: 0; 
            padding: 20px; 
        }
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 20px; 
            justify-content: center; 
            padding: 20px; 
        }
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); 
            text-align: center; 
        }
        .alert { color: red; font-weight: bold; font-size: 18px; }
        .safe { color: green; font-weight: bold; font-size: 18px; }
        table { 
            width: 80%; 
            margin: 20px auto; 
            border-collapse: collapse; 
            background: white; 
            font-size: 18px;
        }
        th, td { 
            padding: 15px; 
            border: 1px solid #ddd; 
            text-align: center; 
        }
        th { background: #007bff; color: white; }
        canvas { max-width: 100%; height: 300px !important; }
    </style>
</head>
<body>
    <h1>üåç Air Quality Monitoring Dashboard</h1>

    <div class="dashboard">
        <!-- Air Quality Gauge -->
        <div class="card">
            <h2>Air Quality Level</h2>
            <canvas id="gaugeAirQuality"></canvas>
            <p id="alertAirQuality" class="safe">‚úÖ Air Quality Good</p>
        </div>

        <!-- Temperature Gauge -->
        <div class="card">
            <h2>Temperature</h2>
            <canvas id="gaugeTemperature"></canvas>
            <p id="tempValue">-- ¬∞C</p>
            <p id="alertTemperature" class="safe">‚úÖ Comfortable Temperature</p>
        </div>

        <!-- Humidity Gauge -->
        <div class="card">
            <h2>Humidity</h2>
            <canvas id="gaugeHumidity"></canvas>
            <p id="humValue">-- %</p>
            <p id="alertHumidity" class="safe">‚úÖ Comfortable Humidity</p>
        </div>
    </div>

    <!-- Gas Concentration Table -->
    <h2>üî• Gas Concentration Levels</h2>
    <table>
        <thead>
            <tr>
                <th>Gas</th>
                <th>PPM Level</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>CO2</td><td id="co2">--</td></tr>
            <tr><td>NH3</td><td id="nh3">--</td></tr>
            <tr><td>Benzene</td><td id="benzene">--</td></tr>
            <tr><td>Smoke</td><td id="smoke">--</td></tr>
            <tr><td>Alcohol</td><td id="alcohol">--</td></tr>
        </tbody>
    </table>

    <!-- Large Charts -->
    <div class="dashboard">
        <div class="card" style="width: 100%;">
            <h2>üìä Temperature & Humidity Trends</h2>
            <canvas id="tempHumChart"></canvas>
        </div>
        <div class="card" style="width: 100%;">
            <h2>üõ¢Ô∏è Gas Concentrations Over Time</h2>
            <canvas id="gasChart"></canvas>
        </div>
    </div>

    <script>
        function createGauge(canvasId, maxVal) {
            let opts = {
                angle: 0.15, lineWidth: 0.2, radiusScale: 1,
                pointer: { length: 0.7, color: '#000000' },
                limitMax: true, limitMin: true, colorStart: '#6FADCF', colorStop: '#8FC0DA', strokeColor: '#E0E0E0'
            };
            let target = document.getElementById(canvasId);
            let gauge = new Gauge(target).setOptions(opts);
            gauge.maxValue = maxVal;
            gauge.setMinValue(0);
            gauge.animationSpeed = 32;
            gauge.set(0);
            return gauge;
        }

        let gaugeAirQuality = createGauge("gaugeAirQuality", 500);
        let gaugeTemperature = createGauge("gaugeTemperature", 50);
        let gaugeHumidity = createGauge("gaugeHumidity", 100);

        const tempHumChart = new Chart(document.getElementById("tempHumChart"), {
            type: 'line',
            data: { labels: [], datasets: [
                { label: "Temperature (¬∞C)", data: [], borderColor: "red", fill: false },
                { label: "Humidity (%)", data: [], borderColor: "blue", fill: false }
            ]}
        });

        const gasChart = new Chart(document.getElementById("gasChart"), {
            type: 'bar',
            data: { labels: ["CO2", "NH3", "Benzene", "Smoke", "Alcohol"],
                    datasets: [{ label: "PPM Levels", data: [0, 0, 0, 0, 0], backgroundColor: ["#ff4d4d", "#ff9933", "#ffcc00", "#66ccff", "#9999ff"] }] }
        });

        function fetchData() {
    fetch('/data')
        .then(response => response.json())
        .then(data => {
            gaugeAirQuality.set(data.co2);
            gaugeTemperature.set(data.temperature);
            gaugeHumidity.set(data.humidity);

            document.getElementById("tempValue").textContent = data.temperature + " ¬∞C";
            document.getElementById("humValue").textContent = data.humidity + " %";

            // Air Quality Alert
            let airAlert = document.getElementById("alertAirQuality");
            if (data.co2 > 2000) {
                airAlert.textContent = "üö® Critical Air Quality! Immediate Action Required!";
                airAlert.className = "alert critical";
            } else if (data.co2 > 1000) {
                airAlert.textContent = "‚ö†Ô∏è Poor Air Quality! Take Action!";
                airAlert.className = "alert";
            } else {
                airAlert.textContent = "‚úÖ Good Air Quality";
                airAlert.className = "safe";
            }

            // Temperature Alert
            let tempAlert = document.getElementById("alertTemperature");
            if (data.temperature > 36 || data.temperature < 12) {
                tempAlert.textContent = "‚ö†Ô∏è Uncomfortable Temperature!";
                tempAlert.className = "alert";
            } else {
                tempAlert.textContent = "‚úÖ Comfortable Temperature";
                tempAlert.className = "safe";
            }

            // Humidity Alert
            let humAlert = document.getElementById("alertHumidity");
            if (data.humidity > 60 || data.humidity < 30) {
                humAlert.textContent = "‚ö†Ô∏è Uncomfortable Humidity!";
                humAlert.className = "alert";
            } else {
                humAlert.textContent = "‚úÖ Comfortable Humidity";
                humAlert.className = "safe";
            }

            // Update Gas Readings
            document.getElementById("co2").textContent = data.co2 + " ppm";
            document.getElementById("nh3").textContent = data.nh3 + " ppm";
            document.getElementById("benzene").textContent = data.benzene + " ppm";
            document.getElementById("smoke").textContent = data.smoke + " ppm";
            document.getElementById("alcohol").textContent = data.alcohol + " ppm";

            // Update Charts
            let time = new Date().toLocaleTimeString();
            tempHumChart.data.labels.push(time);
            tempHumChart.data.datasets[0].data.push(data.temperature);
            tempHumChart.data.datasets[1].data.push(data.humidity);
            tempHumChart.update();

            gasChart.data.datasets[0].data = [data.co2, data.nh3, data.benzene, data.smoke, data.alcohol];
            gasChart.update();
        })
        .catch(error => console.error("Error fetching data:", error));
}


        setInterval(fetchData, 2000);
    </script>
</body>
</html>
